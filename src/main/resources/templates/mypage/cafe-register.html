<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>사업장 등록</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" th:href="@{/css/cafe-register.css}">
</head>
<div layout:fragment="content" class="page--with-navbar">
<body>

    <div class="g-container">

        <!-- 헤더 카드 -->
        <div class="card page-header">
            <h1>사업장 등록</h1>
            <p>기본 정보만 먼저 등록하세요. 상세 정보(메뉴/운영시간/사진)는 이후에 추가할 수 있어요.</p>
        </div>

        <!-- 알림/오류 -->
        <div th:if="${toast}" class="card alert alert-success">
            <span th:text="${toast}">등록되었습니다.</span>
        </div>
        <div th:if="${error}" class="card alert alert-error">
            <span th:text="${error}">오류가 발생했습니다.</span>
        </div>

        <!-- ✅ 단일 폼: 가게 정보 + 사진을 한 번에 제출 -->
        <div class="card register-form">
            <form th:action="@{/mypage/cafe/register(reauth=${param.reauth})}"
                  method="post"
                  enctype="multipart/form-data"
                  autocomplete="on">

                <!-- CSRF -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- 사업자번호: hidden (필요 시) -->
                <input type="hidden" name="businessNumber"
                       th:value="${user != null and user.businessUser != null ? user.businessUser.businessNumber : ''}"/>

                <!-- 그리드 -->
                <div class="grid-cols">
                    <!-- 좌측 칼럼 -->
                    <div class="col">
                        <div class="form-group">
                            <label for="companyName">상호명(회사명) <span class="required">*</span></label>
                            <!-- Cafe.name -->
                            <input id="companyName" name="name" type="text" required
                                   placeholder="예) 빈스팟 커피"
                                   th:value="${biz != null ? biz.companyName : ''}"/>
                        </div>

                        <div class="form-group">
                            <label for="representativeName">대표자 이름</label>
                            <input id="representativeName" name="representativeName" type="text"
                                   placeholder="예) 홍길동"
                                   th:value="${biz != null ? biz.representativeName : ''}"/>
                        </div>

                        <div class="form-group">
                            <label for="representativeEmail">대표자 이메일</label>
                            <input id="representativeEmail" name="representativeEmail" type="email"
                                   placeholder="you@example.com"
                                   th:value="${biz != null ? biz.representativeEmail : ''}"/>
                        </div>

                        <div class="form-group">
                            <label for="representativePhone">대표자 연락처</label>
                            <!-- Cafe.phoneNum -->
                            <input id="representativePhone" name="phoneNum" type="tel"
                                   placeholder="010-1234-5678"
                                   th:value="${biz != null ? biz.representativePhone : ''}"/>
                        </div>
                    </div>

                    <!-- 우측 칼럼 -->
                    <div class="col">
                        <div class="form-group">
                            <label for="address">사업장 주소</label>
                            <!-- Cafe.address1 / address2 / district / city -->
                            <input id="address" name="address1" type="text"
                                   placeholder="예) 서울특별시 강남구 테헤란로..."
                                   th:value="${biz != null ? biz.address : ''}"/>

                            <input name="address2" type="text" placeholder="상세 주소" style="margin-top:8px;"
                                   th:value="${biz != null ? biz.address2 : ''}"/>


                        </div>

                        <!-- (선택) 위치/영업시간/주차 -->
                        <div class="form-group" style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                            <input name="openTime" type="time" placeholder="영업 시작"/>
                            <input name="closeTime" type="time" placeholder="영업 종료"/>
                        </div>

                        <!-- 사진 등록 (같은 폼에서 전송) -->
                        <div class="form-group">
                            <label>가게 사진</label>

                            <!-- 트리거 버튼 -->
                            <div style="display:flex; align-items:center; gap:8px;">
                                <button type="button" class="btn" id="btn-photo-pick">사진 등록하기</button>
                                <small class="text-muted">JPG/PNG 권장, 최대 10장 · 1장당 5MB 이내</small>
                            </div>

                            <!-- 실제 파일 인풋(숨김) : name="photos" -->
                            <input type="file"
                                   id="photos"
                                   name="photos"
                                   accept="image/*"
                                   multiple
                                   hidden>

                            <!-- 미리보기 영역 -->
                            <div id="photo-preview" class="photo-preview-grid" style="margin-top:10px;"></div>
                        </div>

                        <div class="form-group">
                            <label for="description">소개/설명</label>
                            <textarea id="description" name="description" rows="6"
                                      placeholder="가게 소개, 시그니처 메뉴, 좌석 수, 콘센트/주차/와이파이 정보 등"
                                      th:text="${param.description}"></textarea>
                        </div>
                    </div>
                </div>

                <!-- 액션 -->
                <div class="actions">
                    <a th:href="@{/mypage/cafe/manage}" class="btn secondary">취소</a>
                    <button type="submit" class="btn">등록하기</button>
                </div>
            </form>
        </div>

    </div>

    <script th:src="@{/js/cafe-register.js}" defer></script>

</body>
</div>
</html>
