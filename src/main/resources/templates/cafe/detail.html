<!-- templates/cafe/detail.html -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${cafe.name} + ' - 상세'">카페 상세</title>

    <!-- CSRF 메타 (AJAX/폼 제출 시 사용) -->
    <meta th:if="${_csrf}" name="_csrf" th:content="${_csrf.token}"/>
    <meta th:if="${_csrf}" name="_csrf_header" th:content="${_csrf.headerName}"/>

    <style>
        :root { --bd:#e5e7eb; --ink:#111827; --muted:#6b7280; --bg:#fafafa; }
        body { font-family: system-ui, apple-system, Segoe UI, Roboto, Pretendard, Arial, sans-serif;
               margin:0; padding:24px; background:var(--bg); color:var(--ink); }
        .cafe-container { max-width: 960px; margin: 0 auto; }

        .cafe-card { background:#fff; border:1px solid var(--bd); border-radius:14px; padding:16px;
                     box-shadow:0 1px 2px rgba(0,0,0,.04); }
        .cafe-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
        .cafe-title { font-size:22px; font-weight:600; margin:0; }
        .cafe-muted { color:var(--muted); font-size:14px; }
        .cafe-badges { display:flex; flex-wrap:wrap; gap:8px; }
        .cafe-badge { padding:4px 8px; border:1px solid var(--bd); border-radius:999px; font-size:12px; background:#fff; }

        .cafe-grid { display:grid; grid-template-columns:1.2fr 1fr; gap:16px; margin-top:16px; }
        .cafe-section { display:grid; gap:12px; }
        .cafe-field { display:grid; gap:6px; }
        .cafe-label { font-weight:600; }
        .cafe-value { color:#1f2937; }
        .cafe-actions { display:flex; gap:8px; }

        .cafe-form { display:grid; gap:8px; background:#fff; border:1px solid var(--bd); border-radius:12px; padding:12px; }
        .cafe-input { padding:10px 12px; border:1px solid var(--bd); border-radius:10px; width:100%; }
        .cafe-btn { padding:10px 14px; border:1px solid var(--bd); border-radius:10px; background:#fff; cursor:pointer; }
        .cafe-link { text-decoration:none; color:inherit; border:1px solid var(--bd); border-radius:10px; padding:8px 12px; background:#fff; }

        @media (max-width: 820px) {
          .cafe-grid { grid-template-columns:1fr; }
        }
    </style>
</head>
<body>
<div th:replace="fragments/alerts :: toast"></div>
<div class="cafe-container">

    <!-- 상단 카드 -->
    <section class="cafe-card">
        <div class="cafe-header">
            <h1 class="cafe-title" th:text="${cafe.name}">카페명</h1>
            <div class="cafe-badges">
                <span class="cafe-badge" th:text="'평균 ★ ' + ${#numbers.formatDecimal(avgRating,1,2)}">평균 ★ 0.00</span>
                <span class="cafe-badge" th:text="'리뷰 ' + ${reviewCount} + '개'">리뷰 0개</span>
                <span class="cafe-badge" th:if="${cafe.categoryCode}" th:text="${cafe.categoryCode}">CATEGORY</span>
                <span class="cafe-badge" th:text="${cafe.active} ? '활성' : '비활성'">상태</span>
            </div>
        </div>
        <div class="cafe-muted" th:text="${cafe.address}">주소</div>
        <div class="cafe-muted" th:if="${cafe.phone}" th:text="'전화: ' + ${cafe.phone}">전화</div>

        <div class="cafe-actions" style="margin-top:12px;">
            <a class="cafe-link" th:href="@{|/cafes/${cafe.id}/reviews|}">리뷰 보기</a>
            <a class="cafe-link" th:href="@{/cafes}">목록으로</a>
        </div>
    </section>

    <!-- 상세/수정 그리드 -->
    <section class="cafe-grid">

        <!-- 왼쪽: 정보 -->
        <div class="cafe-section">
            <div class="cafe-card">
                <div class="cafe-field">
                    <div class="cafe-label">카테고리 코드</div>
                    <div class="cafe-value" th:text="${cafe.categoryCode != null ? cafe.categoryCode : '-'}">-</div>
                </div>
                <div class="cafe-field">
                    <div class="cafe-label">위치 (위도/경도)</div>
                    <div class="cafe-value"
                         th:text="${(cafe.latitude != null ? cafe.latitude : '-')} + ' / ' + (cafe.longitude != null ? cafe.longitude : '-')">- / -</div>
                </div>
                <div class="cafe-field">
                    <div class="cafe-label">생성일</div>
                    <div class="cafe-value" th:text="${#temporals.format(cafe.createdAt, 'yyyy-MM-dd HH:mm')}">-</div>
                </div>
                <div class="cafe-field">
                    <div class="cafe-label">수정일</div>
                    <div class="cafe-value" th:text="${#temporals.format(cafe.updatedAt, 'yyyy-MM-dd HH:mm')}">-</div>
                </div>
            </div>
        </div>

        <!-- 오른쪽: 수정 폼 -->
        <div class="cafe-section">

            <!-- 전화번호 수정 -->
            <form class="cafe-form" th:action="@{|/cafes/${cafe.id}/phone|}" method="post">
                <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="cafe-label">전화번호 수정</div>
                <input class="cafe-input" type="text" name="phone" placeholder="예: 02-123-4567" th:value="${cafe.phone}">
                <button class="cafe-btn" type="submit">저장</button>
            </form>

            <!-- 좌표 수정 -->
            <form class="cafe-form" th:action="@{|/cafes/${cafe.id}/location|}" method="post">
                <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="cafe-label">위치 좌표 수정</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                    <input class="cafe-input" type="number" step="0.0000001" name="latitude" placeholder="위도"
                           th:value="${cafe.latitude}">
                    <input class="cafe-input" type="number" step="0.0000001" name="longitude" placeholder="경도"
                           th:value="${cafe.longitude}">
                </div>
                <button class="cafe-btn" type="submit">저장</button>
            </form>

            <!-- 카테고리 코드 수정 -->
            <form class="cafe-form" th:action="@{|/cafes/${cafe.id}/category|}" method="post">
                <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="cafe-label">카테고리 코드 변경</div>
                <input class="cafe-input" type="text" name="categoryCode" placeholder="예: CAFE/BAKERY"
                       th:value="${cafe.categoryCode}">
                <button class="cafe-btn" type="submit">저장</button>
            </form>

            <!-- 활성/비활성 토글 -->
            <form class="cafe-form" th:action="@{|/cafes/${cafe.id}/active|}" method="post">
                <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="cafe-label">노출 상태</div>
                <select class="cafe-input" name="active">
                    <option th:value="true" th:selected="${cafe.active}">활성</option>
                    <option th:value="false" th:selected="${!cafe.active}">비활성</option>
                </select>
                <button class="cafe-btn" type="submit">적용</button>
            </form>

        </div>
    </section>

</div>
</body>
</html>
