<html layout:decorate="~{layout}">
<div layout:fragment="content">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/cafe_detail_con1.css}">


    <head>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    </head>
    <style>
        /* ë¦¬ë·° ì „ì²´ ì»¨í…Œì´ë„ˆ */
        .review-summary .review-container {
            display: grid;
            grid-template-columns: repeat(2, minmax(200px, 38%));
            /* 2ì—´ ê·¸ë¦¬ë“œ */
            justify-content: center;
            gap: 20px;
            /* ë¦¬ë·° ì•„ì´í…œ ê°„ ê°„ê²© */
            margin-top: 16px;
            margin-bottom: 8px;
            padding: 20px;
            border-radius: 12px;
            border: 1px dashed #833C0D;
            background-color: #EDE9E8;
            padding-top: 30px;
            position: relative;
            font-family: 'Noto Sans KR'
        }

        .review-subject {
            position: absolute;
            margin-top: 5px;
            left: 20px;
            background-color: #EDE9E8;
            padding: 0 8px;
            font-weight: bold;
            color: #654429;
            font-size: 16px;
            z-index: 1;
            /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— ì˜¬ë¼ì˜¤ë„ë¡ */
        }

        /* ê° ë¦¬ë·° ì•„ì´í…œ */
        .review-item {
            background-color: #E5D9CB;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            border: 1px solid #BC9073;
            justify-content: space-between;
            min-height: 100px;
            /*  max-height: 100px; ê³ ì • ë†’ì´ */
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            overflow: hidden;
        }

        /* ë¦¬ë·° ì•„ì´í…œ ë‚´ë¶€ì˜ Flex ì»¨í…Œì´ë„ˆ */
        .review-item-inner {
            display: flex;
            flex-direction: row;
            /* ê°€ë¡œ ë°©í–¥ìœ¼ë¡œ ë°°ì¹˜ */
            flex-grow: 1;
            /* ë¶€ëª¨(.review-item)ì˜ ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€ */
            align-items: flex-start;
        }

        /* ì‚¬ì§„ í”Œë ˆì´ìŠ¤í™€ë” */
        .review-image-placeholder {
            /* position: relative; */
            width: 100px;
            height: 100px;
            background-color: #D8A77F;
            background-image: url("/images/review_no_img.png");
            background-size: contain;
            border-radius: 4px;
            margin-right: 15px;
            flex-shrink: 0;
            border: 1px dashed #BF7F50;
            background-position: center;
        }

        /* ë³„ì  */
        /*.review-item div span:first-child {
            /* ë³„ì  */
            text-decoration: underline;
            text-underline-offset: 4px;
            display: block;
            font-weight: bold;
            color: #e68a00;
            font-size: 13px;
            margin-bottom: 4px;
        }*/

        /* ë¦¬ë·° ë‚´ìš© */
        .review-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .review-content-text {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            font-size: 13px;
            line-height: 1.5;
            color: #333;
            word-break: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ë¦¬ë·° ì•„ì´í…œ ë‚´ë¶€ì˜ ìƒì„¸ ë‚´ìš© (ex: ì‘ì„±ì, ë‚ ì§œ ë“±) */
        .review-item-details {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        /* ë”ë³´ê¸° ë²„íŠ¼ */
        .more-reviews-button {
            display: block;
            text-align: right;
            justify-content: center;
            width: 20%
                /* ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ */
                margin-top: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background-color: #9A887B;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .more-reviews-button:hover {
            background-color: #55453C;
        }

        /* í•„í„° ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .filter-bar__sort select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 16px;
            /* í•„í„°ì™€ ë¦¬ë·° ì„¹ì…˜ ê°„ ê°„ê²© */
            cursor: pointer;
        }

        /* ë¦¬ë·° ì¹´ìš´íŠ¸ ë° í‰ê·  ë³„ì  */
        .review-summary p {
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }

        .review-summary p span {
            font-weight: bold;
            color: #333;
        }

        .review-stars {
            display: flex;
            align-items: center; /* ì•„ì´ì½˜, ì ìˆ˜ ìˆ˜í‰ ì •ë ¬ */
            gap: 4px;            /* ì•„ì´ì½˜ ì‚¬ì´ ê°„ê²© */
        }

        .review-stars i {
            font-size: 15px;
        }
        .review-score {
            margin-left: 6px;
            font-size: 14px;
            color: #e68a00;
        }

        .review-content-text {
            font-size: 16px;
        }

        /* ì´ë¯¸ì§€ ì˜ì—­ ë°•ìŠ¤ë‘ ë¹„ìœ¨ ë§ì¶”ëŠ” css ì…ë‹ˆë‹¤ */

/* ê³µí†µ: ì´ë¯¸ì§€ë¥¼ ë°•ìŠ¤ ì „ì²´ë¡œ ê½‰ ì±„ìš°ê¸° */
.hero__imgwrap {
  position: relative;
  height: 450px;
  width: 444px;
  overflow: hidden;
  border-radius: 16px;
  line-height: 0;         /* inline ì´ë¯¸ì§€ í•˜ë‹¨ ì—¬ë°± ì œê±° */
}

.hero__img {
  height: 100%;
  object-fit: cover;       /* ë°•ìŠ¤ ê½‰ ì±„ìš°ë˜ ì˜ë¼ëƒ„ */
  display: block;          /* ì¸ë¼ì¸ ì´ë¯¸ì§€ ê¸°ë³¸ ì—¬ë°± ì œê±° */
  max-height: 450px;
}


    </style>

    <!-- ì¹´í˜ëª… + ì˜ì—…ìƒíƒœ -->
    <main class="container-1">

        <!-- ===== í—¤ë”: ì´ë¯¸ì§€ + ì •ë³´ ì¹´ë“œ ===== -->
        <section class="hero" aria-labelledby="cafeTitle">
            <!-- ì´ë¯¸ì§€ -->
            <div class="hero__imgwrap">
                <div th:each="img : ${images}">
                    <!-- ëŒ€í‘œ 1ì¥ë§Œ -->
                    <img th:src="${#lists.isEmpty(images)} ? '/images/DBimg.PNG' : @{${images.get(0).imgUrl}}"
                         class="hero__img" alt="ì¹´í˜ ëŒ€í‘œ ì´ë¯¸ì§€">
                </div>
            </div>





            <!-- ì •ë³´ ì¹´ë“œ -->
            <article class="card">
                <div>
                      <span class="title" id="cafeTitle" th:text="${cafe.name}"></span>
                      <span th:if="${openNow != null}"
                          class=""
                          th:classappend="${openNow} ? 'status open' : 'status closed'"
                          th:text="${openNow} ? '[ì˜ì—…ì¤‘]' : '[ì˜ì—… ë§ˆê°]'">ì˜ì—…ì¤‘</span>
                </div>
                <!-- ì •ë§ ë¹ˆì¹¸ìœ¼ë¡œ ë‘ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ ì¤„ì„ ì‚­ì œí•˜ì„¸ìš” -->
                <span th:if="${openNow == null}" class="muted">ì˜ì—…ì‹œê°„ ë¯¸ë“±ë¡</span>

                <div class="stats">
                    <span class="stat" th:text="|â­ ${#numbers.formatDecimal(avgRating, 1, 1)}"|>â˜… 4.5</span>
                    <span class="stat" th:text="|ë¦¬ë·° ${reviewCount}|">ë¦¬ë·° 0</span>
                    <span class="stat" th:text="|ğŸ‘ ì¡°íšŒìˆ˜ ${cafe.hitCount}"|>ì¡°íšŒ 0</span>
                    <div id="likeBox"
                         th:data-cafe-id="${cafe.id}"
                         th:data-liked="${liked}">
                        <button id="likeBtn" type="button" aria-label="ì¢‹ì•„ìš” í† ê¸€">
                            <span class="label-liked" th:if="${liked}">
                                <i class="fa-solid fa-bookmark" id="activeBookmark"></i>
                            </span>
                            <span class="label-unliked" th:if="${!liked}">
                                <i class="fa-regular fa-bookmark" id="disableBookmarkIcon"></i>
                            </span>
                        </button>
                        <span>
                            ë¶ë§ˆí¬ ì €ì¥ : <b id="likeCount" th:text="${likeCount}">0</b>
                        </span>
                    </div>
                </div>
                <div class="info-grid__row">
                    <div class="title-2">ì£¼ì†Œ</div>
                    <span class="info-grid__value">
                        <span class="link" th:text="${cafe.address1}"></span>
                    </span>
                </div>
                <div class="chips">
                    <div class="title-2" id="">í˜„ì¬ ì¹´í˜ì˜ í‚¤ì›Œë“œ</div>
                    <span class="chip-kw" th:each="k : ${detailKeyword}" th:text="${k.name}">í•©ë¦¬ì ì¸</span>
                </div>
                <span th:if="${#lists.isEmpty(detailKeyword)}" class="chip--empty">
                    ë“±ë¡ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.
                </span>
            </article>
        </section>

        <!-- ===== ì¹´í˜ ì†Œê°œ ===== -->
        <section class="store" aria-labelledby="storeTitle">
            <!-- ì œëª© -->
            <header class="store__header">
                <h2 id="storeTitle" class="store__title">ì¹´í˜ ì†Œê°œ</h2>
            </header>


            <div class="section-aside">
                <!-- ì •ë³´ ê·¸ë¦¬ë“œ -->
                <section class="store__info" aria-label="ê¸°ë³¸ ì •ë³´">
                    <!-- ì†Œê°œ ë¬¸ë‹¨ -->
                    <div class="store__intro">
                        <p class="intro" th:if="${#strings.isEmpty(cafe.intro)}">ë“±ë¡ëœ ì†Œê°œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="intro" th:unless="${#strings.isEmpty(cafe.intro)}" th:text="${cafe.intro}"></p>
                    </div>
                    <ul class="info-grid">
                        <li class="info-grid__row">
                            <span class="info-grid__label">ì˜ì—…ì‹œê°„</span>
                            <span class="info-grid__value">
                            <!-- ìƒíƒœ ë°°ì§€ + ì‹œê°„ -->
                            <span th:if="${openNow != null}"
                                  class=""
                                  th:classappend="${openNow} ? 'status open' : 'status closed'"
                                  th:text="${openNow} ? '[ì˜ì—…ì¤‘]' : '[ì˜ì—… ë§ˆê°]'">ì˜ì—…ì¤‘</span>
                            <span th:if="${cafe.openTime != null and cafe.closeTime != null}"
                                  th:text="|${#temporals.format(cafe.openTime,'HH:mm')} ~ ${#temporals.format(cafe.closeTime,'HH:mm')}|">
                                09:00 ~ 22:00
                            </span>
                        </span>
                        </li>

                        <li class="info-grid__row">
                            <span class="info-grid__label">ì „í™”ë²ˆí˜¸</span>
                            <span class="info-grid__value">
                            <span th:if="${cafe.phoneNum}" th:text="${cafe.phoneNum}"></span>
                            <span th:unless="${cafe.phoneNum}" class="muted">ì—†ìŒ</span>
                        </span>
                        </li>

                        <li class="info-grid__row">
                            <span class="info-grid__label">í¸ì˜ì‹œì„¤</span>
                            <span class="info-grid__value">
                            <span class="chip-kw">
                            <strong>ì£¼ì°¨ </strong>
                            <span th:text="${cafe.parkingYn} ? 'ê°€ëŠ¥' : 'ë¶ˆê°€'">ê°€ëŠ¥</span>
                            </span>
                        </span>
                        </li>

                        <li class="info-grid__row">
                            <span class="info-grid__label">ì›¹ì‚¬ì´íŠ¸</span>
                            <span class="info-grid__value">
                            <a th:if="${cafe.siteUrl}" th:href="${cafe.siteUrl}" target="_blank" rel="noopener">ë°”ë¡œê°€ê¸°</a>
                            <span th:unless="${cafe.siteUrl}" class="muted">ì—†ìŒ</span>
                        </span>
                        </li>
                    </ul>
                </section>

                <aside class="menu-section">
                    <h3 class="title-2">ë©”ë‰´ ëª©ë¡</h3>
                    <ul class="menu-list">
                        <li class="menu-item" th:each="m : ${menus}">
                            <span class="menu-name" th:text="${m.name}">ë©”ë‰´ëª…</span>
                            <span class="menu-price"
                                  th:text="${#numbers.formatInteger(m.price,0,'COMMA')} + ' ì›'">0 ì›</span>
                            <span th:unless="${m.price}" class="muted">ë©”ë‰´ ì—†ìŒ</span>
                        </li>
                    </ul>
                </aside>
            </div>

        </section>



    </main>

    <script src="/js/cafe-like.js"></script>


    <div style="margin-top:8px;">
        <a class="btn" th:href="@{/cafe/map/{cafeId}(cafeId=${cafe.id})}">ì¹´í˜ ìœ„ì¹˜ ë³´ê¸°</a>
    </div>
    <!-- í•˜ë‹¨: ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™ (ìŠ¤íƒ€ì¼ ì—†ìŒ) -->
    <!--  ê¸°ë³¸ìˆœ - ìµœì‹ ìˆœ , ì¸ê¸°ìˆœ - ë¦¬ë·° ì¢‹ì•„ìš” ê°¯ìˆ˜ ìˆœ  -->
    <div style="margin-top:16px;">

        <div class="review-summary">
            <!--   ì†Œìˆ˜ì  ì²«ì§¸ìë¦¬ê¹Œì§€ë§Œ  -->
            <p>í‰ê·  ë³„ì  :
                <span>
        <!-- ì±„ì›Œì§„ ë³„ -->
        <span th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(avgRating))}">
            <i class="fa-solid fa-star"></i>
        </span>

                    <!-- ë°˜ ë³„ (0.5 ì´ìƒì¼ ë•Œ) -->
        <span th:if="${avgRating - T(java.lang.Math).floor(avgRating) >= 0.5}">
            <i class="fa-solid fa-star-half-stroke"></i>
        </span>

                    <!-- ë¹ˆ ë³„ -->
        <span th:each="i : ${#numbers.sequence( 1, 5 - T(java.lang.Math).floor(avgRating) - (avgRating - T(java.lang.Math).floor(avgRating) >= 0.5 ? 1 : 0)
        )}">
            <i class="fa-regular fa-star"></i>
        </span>
    </span>
                <span th:text="${T(java.lang.Math).floor(avgRating * 10) / 10}"></span></p>

            <form th:action="@{/cafe/detail/{id}(id=${cafe.id})}" id="filterForm" method="get"
                  class="filter-form"></form>
            <label class="filter-bar__sort">
                <select name="sort" th:value="${sort}" form="filterForm" onchange="this.form.submit()">
                    <option value="createdAt" th:selected="${sort} == 'createdAt'">ìµœì‹ ìˆœ</option>
                    <option value="hit" th:selected="${sort} == 'hit'">ì¸ê¸°ìˆœ</option>
                </select>
            </label>

            <div class="review-container">
                <div class="review-subject">Review (<span th:text="${reviewCount}"></span>)</div>
                <a th:each="review : ${latestReviews}"
                   th:href="@{/cafes/{id}/reviews(id=${cafe.id})}"
                   class="review-item"
                   style="display: block; text-decoration: none; color: inherit;">

                    <div class="review-item-inner">
                        <div class="review-image-placeholder">
                        </div>
                        <div class="review-content">
                            <div class="review-stars">
                                <!-- ê½‰ ì°¬ ë³„ -->
                                <i class="fa-solid fa-star"
                                   th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(review.rating))}"></i>

                                <!-- ë°˜ ë³„ -->
                                <i class="fa-solid fa-star-half-stroke"
                                   th:if="${review.rating % 1 >= 0.5}"></i>

                                <!-- ë¹ˆ ë³„ -->
                                <i class="fa-regular fa-star"
                                   th:each="i : ${#numbers.sequence(1, 5 - T(java.lang.Math).floor(review.rating) - (review.rating % 1 >= 0.5 ? 1 : 0))}"></i>
                                <span class="review-score" th:text="${review.rating}"></span>
                            </div>

                            <span class="review-content-text" th:text="${review.content}"></span>
                        </div>
                    </div>
                </a>
            </div>
            <!-- ë”ë³´ê¸° ë²„íŠ¼ -->
            <button type="button" class="more-reviews-button"
                    th:onclick="location.href='/cafes/' + [[${cafe.id}]] + '/reviews'">ë”ë³´ê¸°
            </button>
        </div>
    </div>
</div>
</html>