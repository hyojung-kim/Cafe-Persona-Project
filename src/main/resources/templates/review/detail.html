<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<th:block layout:fragment="headExtra">
  <meta charset="UTF-8"/>
  <title th:text="|리뷰 상세 - ${review?.cafe?.name}|">리뷰 상세</title>
</th:block>

<div layout:fragment="content" class="container mt-4">

  <section class="card shadow-sm mb-3">
    <div class="card-body d-flex justify-content-between align-items-start">
      <div>
        <h2 class="h4 mb-1">리뷰 상세</h2>
        <div class="text-muted small">
          작성자:
          <span class="badge bg-info text-dark"
                th:text="${review.user != null ? review.user.username : '알 수 없음'}">작성자</span>
          <span class="ms-2">
            작성일: <time th:text="${#temporals.format(review.createdAt,'yyyy-MM-dd HH:mm')}">-</time>
          </span>
        </div>
      </div>
      <div class="text-end">
        <span class="badge bg-warning text-dark">
          ★ <span th:text="${#numbers.formatDecimal(review.rating,1,1)}">0.0</span> / 5.0
        </span>
        <div class="text-muted small mt-1">
          조회수: <span th:text="${review.viewCount}">0</span>
          <span class="ms-2">좋아요: <b class="like-count" th:text="${review.likeCount}">0</b></span>
        </div>
      </div>
    </div>
  </section>

  <section class="card shadow-sm mb-3">
    <div class="card-body">
      <p class="mb-0" th:text="${review.content}">-</p>
    </div>
  </section>

  <section class="card shadow-sm mb-3"
           th:if="${review.images != null and !#lists.isEmpty(review.images)}">
    <div class="card-body">
      <h3 class="h6 mb-3">첨부 이미지</h3>
      <div class="row row-cols-2 row-cols-md-3 g-2">
        <div class="col" th:each="img : ${review.images}">
          <img th:src="${img.imageUrl}" alt="review image" class="img-fluid rounded"/>
        </div>
      </div>
    </div>
  </section>

  <section class="card shadow-sm">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <form th:action="@{|/reviews/${review.id}/like|}" method="post" class="d-inline review-like-form">
          <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button type="submit" class="btn btn-outline-success btn-sm like-btn">👍 좋아요</button>
        </form>
        <span class="text-muted ms-2 small">♡ <b class="like-count" th:text="${review.likeCount}">0</b></span>
      </div>
      <a class="btn btn-sm btn-primary" th:href="@{|/cafes/${review.cafe.id}/reviews|}">목록</a>
    </div>
  </section>

  <!-- ✅ 레이아웃 삽입 슬롯 없어도 직접 로드 -->
  <script th:src="@{/js/review-like.js}" defer></script>
</div>

</html>
